<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>decimalEngine â€“ Real Mobile Gravity</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { margin: 0; background: black; overflow: hidden; }
  canvas {
    background: white;
    display: block;
    touch-action: none;
  }
</style>
</head>

<body>

<!-- CONTROLS -->
<div class="fixed bottom-3 left-3 right-3 md:top-4 md:left-4 md:right-auto md:w-72 bg-black text-white rounded-2xl p-4 space-y-3 z-10">
  <h1 class="text-center font-bold">
    decimal<span class="opacity-70">Engine</span>
  </h1>

  <select id="mode" class="w-full bg-white text-black rounded px-3 py-2">
    <option value="ball">Place Ball</option>
    <option value="throw">Throw Ball</option>
  </select>

  <button id="clear" class="w-full bg-white text-black rounded py-2 font-semibold">
    Clear
  </button>

  <p class="text-xs opacity-60 text-center">
    Tap once to enable motion ðŸ“±
  </p>
</div>

<canvas id="canvas"></canvas>

<script>
/* ======================
   CANVAS
====================== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ======================
   WORLD
====================== */
const balls = [];
const restitution = 0.6;
const friction = 0.999;

/* REAL GRAVITY VECTOR */
let gX = 0;
let gY = 0.8;

/* ======================
   DEVICE MOTION (REAL)
====================== */
let motionEnabled = false;

function enableMotion() {
  if (motionEnabled) return;

  if (
    typeof DeviceMotionEvent !== "undefined" &&
    typeof DeviceMotionEvent.requestPermission === "function"
  ) {
    DeviceMotionEvent.requestPermission().then(res => {
      if (res === "granted") {
        addEventListener("devicemotion", handleMotion);
        motionEnabled = true;
      }
    });
  } else {
    addEventListener("devicemotion", handleMotion);
    motionEnabled = true;
  }
}

function handleMotion(e) {
  if (!e.accelerationIncludingGravity) return;

  const ax = e.accelerationIncludingGravity.x;
  const ay = e.accelerationIncludingGravity.y;

  /* SCALE + AXIS FIX */
  gX = ax * 0.12;
  gY = ay * 0.12;
}

/* ======================
   OBJECTS
====================== */
function addBall(x, y, vx=0, vy=0) {
  balls.push({
    x, y,
    vx, vy,
    r: 12
  });
}

/* ======================
   COLLISION
====================== */
function resolveWalls(b) {
  if (b.x - b.r < 0) {
    b.x = b.r;
    b.vx *= -restitution;
  }
  if (b.x + b.r > canvas.width) {
    b.x = canvas.width - b.r;
    b.vx *= -restitution;
  }
  if (b.y - b.r < 0) {
    b.y = b.r;
    b.vy *= -restitution;
  }
  if (b.y + b.r > canvas.height) {
    b.y = canvas.height - b.r;
    b.vy *= -restitution;
  }
}

/* ======================
   UPDATE
====================== */
function update() {
  balls.forEach(b => {
    b.vx += gX;
    b.vy += gY;

    b.x += b.vx;
    b.y += b.vy;

    b.vx *= friction;
    b.vy *= friction;

    resolveWalls(b);
  });
}

/* ======================
   DRAW
====================== */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  balls.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
    ctx.fillStyle = "#000";
    ctx.fill();
  });
}

/* ======================
   LOOP
====================== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ======================
   INPUT
====================== */
const mode = document.getElementById("mode");
const clearBtn = document.getElementById("clear");

let startX=0, startY=0;

canvas.addEventListener("pointerdown", e => {
  enableMotion();
  startX = e.clientX;
  startY = e.clientY;
});

canvas.addEventListener("pointerup", e => {
  if (mode.value === "ball") {
    addBall(e.clientX, e.clientY);
  } else {
    addBall(
      startX,
      startY,
      (startX - e.clientX) * 0.15,
      (startY - e.clientY) * 0.15
    );
  }
});

clearBtn.onclick = () => balls.length = 0;
</script>

</body>
</html>
